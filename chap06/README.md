# 第 6 章 布局管理
放置在窗体中的每一个窗口部件都必须给定一个合适的大小和位置。Qt 提供了多个用于在窗体中摆放窗口部件的类：`QHBoxLayout`、`QVBoxLayout`、`QGridLayout`和`QStackedLayout`。  
Qt 布局类可以确保窗体能够自适应于不同的字体、语言和系统平台。

## 6.1 在窗体中摆放窗口部件
一共有三种基本方法用于管理窗体上子窗口部件的布局：绝对位置法、人工布局法和布局管理器法。

### 绝对位置法
绝对位置法是一种最原始的摆放窗口部件的方法，可以通过`QWidget::setGeometry()`方法对窗体的各个子窗口部件分配固定的大小和位置，以及使用`QWidget::setFixedSize()`对窗体分配固定的大小实现。

#### 缺点
+ 用户无法改变窗口的大小
+ 无法自适应于不同的字体、语言和系统平台
+ 必须人工计算这些位置和大小

### 人工布局法
尽管还是需要给定窗口部件的绝对位置，但是利用人工布局方法给定的大小尺寸总是可以和窗口的大小成比例。
通过重新实现窗体的`resizeEvent()`方法，在窗体大小改变时，重新计算窗口部件的位置和大小。

### 布局管理器法
布局管理器会为每种类型的窗口部件提供一些合理的默认值，并且也会考虑每一个窗口部件的大小提示（`sizeHint()`），并且会自动通过调整布局来响应字体的变化、内容的改变以及窗口大小的调整。
布局管理器也会自动根据窗体中子窗口部件的最小大小提示（`minimumSizeHint`）和大小提示（`sizeHint()`），从总体上为这个窗体设置一个最小尺寸。

最为重要的三种布局管理器是：`QHBoxLayout`、`QVBoxLayout`和`QGridLayout`。这三个类从`QLayout`派生，并且提供了`addWidget()`方法，用于将窗口部件添加到布局中，而`QLayout`类为布局提供了基本框架。

#### Qt 设计师中使用布局管理器

### 大小策略（`QSizePolicy`）
一个窗口部件的大小策略会告诉布局系统应该如何对它进行拉伸或者压缩。一个`QSizePolicy`既包含一个水平分量也包含一个垂直分量。
+ `Fixed`：窗口部件不能被拉伸或者压缩。窗口部件的大小尺寸总是保持为其大小提示的尺寸。
+ `Minimum`：窗口部件的大小提示就是它的最小大小。再不能把窗口部件压缩到比这个大小提示还要小的大小，但是可以拉伸它来填充尽可能多的空间。
+ `Maximum`：窗口部件的大小提示就是它的最大大小。但是可以把该窗口部件压缩成它的最小大小提示的尺寸。
+ `Preferred`：窗口部件的大小提示就是它比较合适的大小。可以对该窗口部件进行拉伸和压缩。
+ `Expanding`：可以拉伸或者压缩该窗口部件，并且它特别希望能够变长变高。

## 6.2 分组布局
+ 使用`QStackedLayout`和`QStackedWidget`实现分组布局
+ 绑定`QListWidget`的切项信号和`QStackedWidget`的切换槽函数，实现分组布局
> **经验之谈：通过Qt设计师设计布局时，点击父窗口部件（比如`QGroupBpx`）直接设置布局方式即可。切勿通过区选多个子窗口部件的方式再设置布局方式，此时是往父窗口部件添加了一层子布局，而子窗口部件成了子布局的子窗口部件（成了孙子窗口部件了，自动调整大小的时候，QGroupBox会被缩成很小）。**

## 6.3 切分窗口
### 使用 QSplitter 实现简单的切分窗口
QSplitter 与布局管理器的不同：
+ 布局管理器只是简单地摆放一个窗体中的子窗口部件，其没有可见的外形。
+ QSplitter 是从 QWidget 派生，可以像任何其他窗口部件一样使用。
> 我发现，在 spliiter 这个项目中，我无法将 editor123 定义成普通的局部对象，只能定义成对象指针，否则的话，在关闭 Splitter 窗口时，其析构释放对象内存的时候会有问题。猜测应该是因为子窗口部件的内存管理交给了父窗口部件，和局部变量有冲突（重复释放内存）。

### 使用 Qt 设计师设计邮件客户端
按照书中及其源码给出的示例，我打算使用 Qt 设计师来设计实现邮件客户端。但是在实际操作过程中遇到了一些问题，使用 Qt 设计师编辑`.ui`文件时：
+ 无法设置添加菜单栏的菜单，工具栏和状态栏也是一样；
+ 切分窗口（QSplitter）的布局无法设置伸展因子；
+ `mainSplitter`无法被设置为`QMainWindow`的中央部件；

上面这些等等问题，我只好回到代码中，通过代码来进行设置。

其它问题：
+ 书中描述“邮件列表”时使用的是`QTableWidget`，但是我发现每封邮件都是以一行为项，并不是以单元格为项；于是我便参考源码改用`QTreeWidget`作为邮件列表。
+ 设置 HTML 格式文本时，像左右尖括号这类特殊字符需要进行转义，可直接使用`QString::toHtmlEscaped()`方法。

